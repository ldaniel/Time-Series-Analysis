<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data preparation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">FGV MBA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-hand-holding-usd"></span>
     
    Business Case
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_about_the_data.html">About the Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Initial Analysis</li>
    <li>
      <a href="02_data_preparation.html">Data Preparation</a>
    </li>
    <li>
      <a href="03_exploration_report.html">Data Exploration</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-invoice-dollar"></span>
     
    Final Report
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="conclusion.html">Conclusion</a>
    </li>
    <li>
      <a href="references.html">References</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data preparation</h1>
<h4 class="date">August, 2019</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#using-a-step-by-step-approach"><span class="toc-section-number">1</span> Using a step by step approach</a></li>
<li><a href="#create-functions-step-1"><span class="toc-section-number">2</span> Create Functions (step 1)</a><ul>
<li><a href="#specific-data-ingestion-functions"><span class="toc-section-number">2.1</span> Specific data ingestion functions</a><ul>
<li><a href="#function-1"><span class="toc-section-number">2.1.1</span> Function 1</a></li>
<li><a href="#function-2"><span class="toc-section-number">2.1.2</span> Function 2</a></li>
<li><a href="#function-3"><span class="toc-section-number">2.1.3</span> Function 3</a></li>
<li><a href="#function-n"><span class="toc-section-number">2.1.4</span> Function n</a></li>
</ul></li>
<li><a href="#metrics-auxiliary-functions"><span class="toc-section-number">2.2</span> Metrics auxiliary functions</a><ul>
<li><a href="#calculatemodelmetrics"><span class="toc-section-number">2.2.1</span> calculateModelMetrics</a></li>
<li><a href="#modelmetrics"><span class="toc-section-number">2.2.2</span> modelMetrics</a></li>
</ul></li>
<li><a href="#data-preparation-functions"><span class="toc-section-number">2.3</span> Data preparation functions</a></li>
<li><a href="#plot-auxiliary-functions"><span class="toc-section-number">2.4</span> Plot auxiliary functions</a><ul>
<li><a href="#score_histograms"><span class="toc-section-number">2.4.1</span> Score_Histograms</a></li>
<li><a href="#score_boxplot"><span class="toc-section-number">2.4.2</span> Score_Boxplot</a></li>
<li><a href="#ks_plot"><span class="toc-section-number">2.4.3</span> KS_Plot</a></li>
<li><a href="#plot_roc"><span class="toc-section-number">2.4.4</span> Plot_ROC</a></li>
<li><a href="#accuracy"><span class="toc-section-number">2.4.5</span> accuracy</a></li>
</ul></li>
</ul></li>
<li><a href="#data-ingestion-step-2"><span class="toc-section-number">3</span> Data Ingestion (step 2)</a></li>
<li><a href="#data-cleaning-step-3"><span class="toc-section-number">4</span> Data Cleaning (step 3)</a></li>
<li><a href="#label-translation-step-4"><span class="toc-section-number">5</span> Label Translation (step 4)</a></li>
<li><a href="#data-enhancement-step-5"><span class="toc-section-number">6</span> Data Enhancement (step 5)</a></li>
<li><a href="#data-preparation-for-predictive-modeling-step-6"><span class="toc-section-number">7</span> Data Preparation for Predictive Modeling (step 6)</a><ul>
<li><a href="#selecting-the-target-dataset"><span class="toc-section-number">7.1</span> Selecting the target dataset</a></li>
<li><a href="#splitting-dataset-into-train-and-test-data"><span class="toc-section-number">7.2</span> Splitting dataset into Train and Test data</a></li>
</ul></li>
</ul>
</div>

<div id="using-a-step-by-step-approach" class="section level1">
<h1><span class="header-section-number">1</span> Using a step by step approach</h1>
<p>Before starting the analysis for the {{<strong>myproject</strong>}}, a few important steps were taken in order to prepare the source data files. These steps are listed below:</p>
<ul>
<li><strong>Step 01</strong>: Create Functions;</li>
<li><strong>Step 02</strong>: Data Ingestion;</li>
<li><strong>Step 03</strong>: Data Cleaning;</li>
<li><strong>Step 04</strong>: Label Translation;</li>
<li><strong>Step 05</strong>: Data Enhancement;</li>
<li><strong>Step 06</strong>: Dataset Preparation.</li>
</ul>
<hr />
</div>
<div id="create-functions-step-1" class="section level1">
<h1><span class="header-section-number">2</span> Create Functions (step 1)</h1>
<p>This step create functions to be used in the next steps. Following, all functions created are described.</p>
<div id="specific-data-ingestion-functions" class="section level2">
<h2><span class="header-section-number">2.1</span> Specific data ingestion functions</h2>
<div id="function-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Function 1</h3>
<p>Description of function 1.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Function 1 code</span></a></code></pre></div>
</div>
<div id="function-2" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Function 2</h3>
<p>Description of function 2.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Function 2 code</span></a></code></pre></div>
</div>
<div id="function-3" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Function 3</h3>
<p>Description of function 3.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Function 3 code</span></a></code></pre></div>
</div>
<div id="function-n" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Function n</h3>
<p>Description of function n.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Function n code</span></a></code></pre></div>
</div>
</div>
<div id="metrics-auxiliary-functions" class="section level2">
<h2><span class="header-section-number">2.2</span> Metrics auxiliary functions</h2>
<div id="calculatemodelmetrics" class="section level3">
<h3><span class="header-section-number">2.2.1</span> calculateModelMetrics</h3>
<p>The objective of this function is to calculate main metrics of model performance according to a cutoff value.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">calculateModelMetrics &lt;-<span class="st"> </span><span class="cf">function</span>(cutData, realData, predData){</a>
<a class="sourceLine" id="cb5-2" title="2">  cuttedData &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(predData<span class="op">&gt;=</span>cutData, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb5-3" title="3">  </a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">invisible</span>(<span class="kw">capture.output</span>(out &lt;-<span class="st"> </span><span class="kw">CrossTable</span>(realData, cuttedData, </a>
<a class="sourceLine" id="cb5-5" title="5">                                             <span class="dt">prop.c =</span> F, <span class="dt">prop.t =</span> F, <span class="dt">prop.r =</span> T, <span class="dt">prop.chisq =</span> F)))</a>
<a class="sourceLine" id="cb5-6" title="6">  </a>
<a class="sourceLine" id="cb5-7" title="7">  out &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(out) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">merged=</span><span class="kw">paste0</span>(t.x, t.y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(merged, <span class="dt">val=</span>t.Freq)</a>
<a class="sourceLine" id="cb5-10" title="10">  </a>
<a class="sourceLine" id="cb5-11" title="11">  TN &lt;-<span class="st"> </span><span class="kw">filter</span>(out, merged <span class="op">==</span><span class="st"> &quot;00&quot;</span>)<span class="op">$</span>val[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-12" title="12">  FP &lt;-<span class="st"> </span><span class="kw">filter</span>(out, merged <span class="op">==</span><span class="st"> &quot;01&quot;</span>)<span class="op">$</span>val[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-13" title="13">  FN &lt;-<span class="st"> </span><span class="kw">filter</span>(out, merged <span class="op">==</span><span class="st"> &quot;10&quot;</span>)<span class="op">$</span>val[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-14" title="14">  TP &lt;-<span class="st"> </span><span class="kw">filter</span>(out, merged <span class="op">==</span><span class="st"> &quot;11&quot;</span>)<span class="op">$</span>val[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-15" title="15">  </a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">return</span>(<span class="kw">data.frame</span>(<span class="dt">Cut =</span> cutData,</a>
<a class="sourceLine" id="cb5-17" title="17">                    <span class="dt">TN =</span> TN, </a>
<a class="sourceLine" id="cb5-18" title="18">                    <span class="dt">FP =</span> FP,</a>
<a class="sourceLine" id="cb5-19" title="19">                    <span class="dt">FN =</span> FN, </a>
<a class="sourceLine" id="cb5-20" title="20">                    <span class="dt">TP =</span> TP,</a>
<a class="sourceLine" id="cb5-21" title="21">                    <span class="dt">TPR =</span> TP<span class="op">/</span>(TP<span class="op">+</span>FN), <span class="dt">TNR=</span>TN<span class="op">/</span>(TN<span class="op">+</span>FP),</a>
<a class="sourceLine" id="cb5-22" title="22">                    <span class="dt">Error =</span> (FP<span class="op">+</span>FN)<span class="op">/</span>(TP<span class="op">+</span>TN<span class="op">+</span>FP<span class="op">+</span>FN),</a>
<a class="sourceLine" id="cb5-23" title="23">                    <span class="dt">Precision =</span> TP<span class="op">/</span>(TP<span class="op">+</span>FP),</a>
<a class="sourceLine" id="cb5-24" title="24">                    <span class="dt">F1 =</span> <span class="dv">2</span><span class="op">*</span>(TP<span class="op">/</span>(TP<span class="op">+</span>FN))<span class="op">*</span>(TP<span class="op">/</span>(TP<span class="op">+</span>FP))<span class="op">/</span>((TP<span class="op">/</span>(TP<span class="op">+</span>FP)) <span class="op">+</span><span class="st"> </span>(TP<span class="op">/</span>(TP<span class="op">+</span>FN)))))</a>
<a class="sourceLine" id="cb5-25" title="25">}</a></code></pre></div>
</div>
<div id="modelmetrics" class="section level3">
<h3><span class="header-section-number">2.2.2</span> modelMetrics</h3>
<p>The objective of this function is to calculate main metrics of model performance for cutoffs from 0-1 based on given step.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">modelMetrics &lt;-<span class="st"> </span><span class="cf">function</span>(realData, predData, <span class="dt">stepping =</span> <span class="fl">0.01</span>, </a>
<a class="sourceLine" id="cb6-2" title="2">                         <span class="dt">plot_title =</span> <span class="st">&quot;TPR/TNR by cutoff over full dataset&quot;</span>){</a>
<a class="sourceLine" id="cb6-3" title="3">  probCuts &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> stepping)</a>
<a class="sourceLine" id="cb6-4" title="4">  out &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">lapply</span>(probCuts, calculateModelMetrics, <span class="dt">realData =</span> realData, <span class="dt">predData =</span> predData))</a>
<a class="sourceLine" id="cb6-5" title="5">  out &lt;-<span class="st"> </span>out[<span class="kw">complete.cases</span>(out),] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Difference =</span> <span class="kw">abs</span>(TPR<span class="op">-</span>TNR))</a>
<a class="sourceLine" id="cb6-6" title="6">  </a>
<a class="sourceLine" id="cb6-7" title="7">  best &lt;-<span class="st"> </span>out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Difference) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Difference)</a>
<a class="sourceLine" id="cb6-8" title="8">  </a>
<a class="sourceLine" id="cb6-9" title="9">  p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>out<span class="op">$</span>Cut, <span class="dt">y =</span> <span class="op">~</span>out<span class="op">$</span>Difference, <span class="dt">name =</span> <span class="st">&#39;Abs. Diff.&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;bar&#39;</span>, <span class="dt">opacity =</span> <span class="fl">0.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="st">    </span><span class="kw">add_trace</span>(<span class="dt">x =</span> <span class="op">~</span>out<span class="op">$</span>Cut, <span class="dt">y =</span> <span class="op">~</span>out<span class="op">$</span>TPR, <span class="dt">name =</span> <span class="st">&#39;TPR&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="dt">mode =</span> <span class="st">&#39;lines&#39;</span>, <span class="dt">opacity =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="st">    </span><span class="kw">add_trace</span>(<span class="dt">x =</span> <span class="op">~</span>out<span class="op">$</span>Cut, <span class="dt">y =</span> <span class="op">~</span>out<span class="op">$</span>TNR, <span class="dt">name =</span> <span class="st">&#39;TNR&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="dt">mode =</span> <span class="st">&#39;lines&#39;</span>, <span class="dt">opacity =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="st">    </span><span class="kw">layout</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Cutoff Value&quot;</span>),</a>
<a class="sourceLine" id="cb6-13" title="13">           <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;True Ratio (%)&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">    </span><span class="kw">add_annotations</span>(</a>
<a class="sourceLine" id="cb6-15" title="15">      <span class="dt">text =</span> <span class="kw">sprintf</span>(<span class="st">&quot;&lt;b&gt;%s&lt;/b&gt;&quot;</span>, plot_title),</a>
<a class="sourceLine" id="cb6-16" title="16">      <span class="dt">x =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb6-17" title="17">      <span class="dt">y =</span> <span class="fl">1.04</span>,</a>
<a class="sourceLine" id="cb6-18" title="18">      <span class="dt">yref =</span> <span class="st">&quot;paper&quot;</span>,</a>
<a class="sourceLine" id="cb6-19" title="19">      <span class="dt">xref =</span> <span class="st">&quot;paper&quot;</span>,</a>
<a class="sourceLine" id="cb6-20" title="20">      <span class="dt">xanchor =</span> <span class="st">&quot;left&quot;</span>,</a>
<a class="sourceLine" id="cb6-21" title="21">      <span class="dt">yanchor =</span> <span class="st">&quot;top&quot;</span>,</a>
<a class="sourceLine" id="cb6-22" title="22">      <span class="dt">showarrow =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-23" title="23">      <span class="dt">font =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb6-24" title="24">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="st">    </span><span class="kw">add_annotations</span>(</a>
<a class="sourceLine" id="cb6-26" title="26">      <span class="dt">text =</span> <span class="kw">sprintf</span>(<span class="st">&quot;&lt;b&gt;%s&lt;/b&gt;&quot;</span>, best<span class="op">$</span>Cut),</a>
<a class="sourceLine" id="cb6-27" title="27">      <span class="dt">x =</span> best<span class="op">$</span>Cut,</a>
<a class="sourceLine" id="cb6-28" title="28">      <span class="dt">y =</span> best<span class="op">$</span>TPR,</a>
<a class="sourceLine" id="cb6-29" title="29">      <span class="dt">showarrow =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-30" title="30">      <span class="dt">bgcolor =</span> <span class="st">&quot;white&quot;</span>,</a>
<a class="sourceLine" id="cb6-31" title="31">      <span class="dt">opacity =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb6-32" title="32">    )</a>
<a class="sourceLine" id="cb6-33" title="33">  </a>
<a class="sourceLine" id="cb6-34" title="34">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">TableResults =</span> out,</a>
<a class="sourceLine" id="cb6-35" title="35">              <span class="dt">BestCut =</span> best,</a>
<a class="sourceLine" id="cb6-36" title="36">              <span class="dt">Plot =</span> p))</a>
<a class="sourceLine" id="cb6-37" title="37">}</a></code></pre></div>
</div>
</div>
<div id="data-preparation-functions" class="section level2">
<h2><span class="header-section-number">2.3</span> Data preparation functions</h2>
<div id="createtestandtrainsamples" class="section level4">
<h4><span class="header-section-number">2.3.0.1</span> createTestAndTrainSamples</h4>
<p>See topic “Splitting dataset into Train and Test data” for further details.</p>
</div>
</div>
<div id="plot-auxiliary-functions" class="section level2">
<h2><span class="header-section-number">2.4</span> Plot auxiliary functions</h2>
<p>Functions used in the evaluation step to compare the models.</p>
<div id="score_histograms" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Score_Histograms</h3>
<p>Function used to plot the score density plots of the model.</p>
<p>Needs to receive a dataset containing the predicted and actual values, the actual values vector the score (predicted) values value and a custom title.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">Score_Histograms &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, predicted, actual, title) {</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw">ggplot</span>(<span class="dt">data =</span> dataset) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">    </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> predicted, <span class="dt">fill =</span> <span class="kw">as.factor</span>(actual)),</a>
<a class="sourceLine" id="cb7-4" title="4">                 <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span> =<span class="st"> &quot;#16a085&quot;</span>, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;#e74c3c&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">    </span><span class="kw">theme_economist</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> title,</a>
<a class="sourceLine" id="cb7-9" title="9">         <span class="dt">y =</span> <span class="st">&#39;Score&#39;</span>,</a>
<a class="sourceLine" id="cb7-10" title="10">         <span class="dt">fill =</span> <span class="st">&#39;Defaulter |1 = True|&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb7-12" title="12">          <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb7-13" title="13">          <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb7-14" title="14">          <span class="dt">legend.position =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb7-15" title="15">          <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb7-16" title="16">}</a></code></pre></div>
</div>
<div id="score_boxplot" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Score_Boxplot</h3>
<p>Function used to plot the score box plot of the model.</p>
<p>Needs to receive a dataset containing the predicted and actual values, the actual values vector the score (predicted) values value and a custom title.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">Score_Boxplot &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, predicted, actual, title) {</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="kw">ggplot</span>(<span class="dt">data =</span> dataset) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> predicted,</a>
<a class="sourceLine" id="cb8-4" title="4">                     <span class="dt">fill =</span> <span class="kw">as.factor</span>(actual))) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span> =<span class="st"> &quot;#16a085&quot;</span>, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;#e74c3c&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="st">    </span><span class="kw">theme_economist</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> title,</a>
<a class="sourceLine" id="cb8-10" title="10">         <span class="dt">y =</span> <span class="st">&#39;Score&#39;</span>,</a>
<a class="sourceLine" id="cb8-11" title="11">         <span class="dt">fill =</span> <span class="st">&#39;Defaulter |1 = True|&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-13" title="13">          <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-14" title="14">          <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-15" title="15">          <span class="dt">legend.position =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb8-16" title="16">          <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb8-17" title="17">}</a></code></pre></div>
</div>
<div id="ks_plot" class="section level3">
<h3><span class="header-section-number">2.4.3</span> KS_Plot</h3>
<p>Function used to plot the cumulative probability distribution and KS metric of the model.</p>
<p>Needs to receive a vector with scores of Defaulters and a vector f scores of Non-Defaulters and a custom title.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">KS_Plot &lt;-<span class="st"> </span><span class="cf">function</span>(zeros, ones, title) {</a>
<a class="sourceLine" id="cb9-2" title="2">  group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Non Defaulters&quot;</span>, <span class="kw">length</span>(zeros)), <span class="kw">rep</span>(<span class="st">&quot;Defauters&quot;</span>, <span class="kw">length</span>(ones)))</a>
<a class="sourceLine" id="cb9-3" title="3">  dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">KSD =</span> <span class="kw">c</span>(zeros, ones), <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb9-4" title="4">  cdf1 &lt;-<span class="st"> </span><span class="kw">ecdf</span>(zeros) </a>
<a class="sourceLine" id="cb9-5" title="5">  cdf2 &lt;-<span class="st"> </span><span class="kw">ecdf</span>(ones) </a>
<a class="sourceLine" id="cb9-6" title="6">  minMax &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(zeros, ones), <span class="kw">max</span>(zeros, ones), <span class="dt">length.out=</span><span class="kw">length</span>(zeros)) </a>
<a class="sourceLine" id="cb9-7" title="7">  x0 &lt;-<span class="st"> </span>minMax[<span class="kw">which</span>( <span class="kw">abs</span>(<span class="kw">cdf1</span>(minMax) <span class="op">-</span><span class="st"> </span><span class="kw">cdf2</span>(minMax)) <span class="op">==</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="st">                        </span><span class="kw">max</span>(<span class="kw">abs</span>(<span class="kw">cdf1</span>(minMax) <span class="op">-</span><span class="st"> </span><span class="kw">cdf2</span>(minMax))) )][<span class="dv">1</span>] </a>
<a class="sourceLine" id="cb9-9" title="9">  y0 &lt;-<span class="st"> </span><span class="kw">cdf1</span>(x0)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-10" title="10">  y1 &lt;-<span class="st"> </span><span class="kw">cdf2</span>(x0)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-11" title="11">  ks &lt;-<span class="st"> </span><span class="kw">round</span>(y0 <span class="op">-</span><span class="st"> </span>y1, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-12" title="12">  </a>
<a class="sourceLine" id="cb9-13" title="13">  <span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> KSD, <span class="dt">group =</span> group, <span class="dt">color =</span> group))<span class="op">+</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="st">    </span><span class="kw">stat_ecdf</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x0[<span class="dv">1</span>], <span class="dt">y =</span> y0[<span class="dv">1</span>], <span class="dt">xend =</span> x0[<span class="dv">1</span>], <span class="dt">yend =</span> y1[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb9-16" title="16">                 <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x0[<span class="dv">1</span>] , <span class="dt">y =</span> y0[<span class="dv">1</span>]), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x0[<span class="dv">1</span>] , <span class="dt">y =</span> y1[<span class="dv">1</span>]), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="st">    </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x0[<span class="dv">1</span>], <span class="dt">y =</span> y1[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>(y0[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>y1[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">label =</span> ks),</a>
<a class="sourceLine" id="cb9-20" title="20">               <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> title,</a>
<a class="sourceLine" id="cb9-23" title="23">         <span class="dt">y =</span> <span class="st">&#39;Cumulative Probability Distribution&#39;</span>,</a>
<a class="sourceLine" id="cb9-24" title="24">         <span class="dt">x =</span> <span class="st">&#39;Score&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="st">    </span><span class="kw">theme_economist</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb9-27" title="27">          <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb9-28" title="28">          <span class="dt">legend.position =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-29" title="29">          <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb9-30" title="30">}</a></code></pre></div>
</div>
<div id="plot_roc" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Plot_ROC</h3>
<p>Function used to plot the combined ROC curves of each model.</p>
<p>Needs to receive a dataset with actual and predicted scores of each model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">Plot_ROC &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, <span class="dt">smooth_opt =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb10-2" title="2">  roc_logistic      &lt;-<span class="st"> </span><span class="kw">roc</span>(logistic.actual <span class="op">~</span><span class="st"> </span>logistic.predicted,</a>
<a class="sourceLine" id="cb10-3" title="3">                           dataset,</a>
<a class="sourceLine" id="cb10-4" title="4">                           <span class="dt">smooth =</span> smooth_opt,</a>
<a class="sourceLine" id="cb10-5" title="5">                           <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-6" title="6">  </a>
<a class="sourceLine" id="cb10-7" title="7">  roc_decision.tree &lt;-<span class="st"> </span><span class="kw">roc</span>(decision.tree.actual <span class="op">~</span><span class="st"> </span>decision.tree.predicted,</a>
<a class="sourceLine" id="cb10-8" title="8">                           dataset,</a>
<a class="sourceLine" id="cb10-9" title="9">                           <span class="dt">smooth =</span> smooth_opt,</a>
<a class="sourceLine" id="cb10-10" title="10">                           <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-11" title="11">  </a>
<a class="sourceLine" id="cb10-12" title="12">  roc_boosting      &lt;-<span class="st"> </span><span class="kw">roc</span>(boosting.actual <span class="op">~</span><span class="st"> </span>boosting.predicted,</a>
<a class="sourceLine" id="cb10-13" title="13">                           dataset,</a>
<a class="sourceLine" id="cb10-14" title="14">                           <span class="dt">smooth =</span> smooth_opt,</a>
<a class="sourceLine" id="cb10-15" title="15">                           <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-16" title="16">  </a>
<a class="sourceLine" id="cb10-17" title="17">  roc_random.forest &lt;-<span class="st"> </span><span class="kw">roc</span>(random.forest.actual <span class="op">~</span><span class="st"> </span>random.forest.predicted,</a>
<a class="sourceLine" id="cb10-18" title="18">                           dataset,</a>
<a class="sourceLine" id="cb10-19" title="19">                           <span class="dt">smooth =</span> smooth_opt,</a>
<a class="sourceLine" id="cb10-20" title="20">                           <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-21" title="21">  </a>
<a class="sourceLine" id="cb10-22" title="22">  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>roc_logistic<span class="op">$</span>specificities, </a>
<a class="sourceLine" id="cb10-24" title="24">                  <span class="dt">y =</span> roc_logistic<span class="op">$</span>sensitivities, </a>
<a class="sourceLine" id="cb10-25" title="25">                  <span class="dt">colour =</span> <span class="st">&#39;Logistic Regression&#39;</span>), <span class="co"># red</span></a>
<a class="sourceLine" id="cb10-26" title="26">              <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-27" title="27">              <span class="dt">linetype =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-28" title="28">              <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>roc_decision.tree<span class="op">$</span>specificities, </a>
<a class="sourceLine" id="cb10-30" title="30">                  <span class="dt">y =</span> roc_decision.tree<span class="op">$</span>sensitivities,</a>
<a class="sourceLine" id="cb10-31" title="31">                  <span class="dt">colour =</span> <span class="st">&#39;Decision Tree&#39;</span>), <span class="co"># blue</span></a>
<a class="sourceLine" id="cb10-32" title="32">              <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-33" title="33">              <span class="dt">linetype =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-34" title="34">              <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>roc_boosting<span class="op">$</span>specificities, </a>
<a class="sourceLine" id="cb10-36" title="36">                  <span class="dt">y =</span> roc_boosting<span class="op">$</span>sensitivities,</a>
<a class="sourceLine" id="cb10-37" title="37">                  <span class="dt">colour =</span> <span class="st">&#39;Boosting&#39;</span>), <span class="co"># green</span></a>
<a class="sourceLine" id="cb10-38" title="38">              <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-39" title="39">              <span class="dt">linetype =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-40" title="40">              <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>roc_random.forest<span class="op">$</span>specificities, </a>
<a class="sourceLine" id="cb10-42" title="42">                  <span class="dt">y =</span> roc_random.forest<span class="op">$</span>sensitivities,</a>
<a class="sourceLine" id="cb10-43" title="43">                  <span class="dt">colour =</span> <span class="st">&#39;Random Forest&#39;</span>), <span class="co"># purple</span></a>
<a class="sourceLine" id="cb10-44" title="44">              <span class="dt">size =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb10-45" title="45">              <span class="dt">linetype =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-46" title="46">              <span class="dt">alpha =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-47" title="47"><span class="st">    </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb10-48" title="48">                <span class="dt">linetype =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb10-49" title="49">                <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-50" title="50"><span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb10-51" title="51">                        <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&#39;Logistic Regression&#39;</span>, </a>
<a class="sourceLine" id="cb10-52" title="52">                                   <span class="st">&#39;Decision Tree&#39;</span>,</a>
<a class="sourceLine" id="cb10-53" title="53">                                   <span class="st">&#39;Boosting&#39;</span>, </a>
<a class="sourceLine" id="cb10-54" title="54">                                   <span class="st">&#39;Random Forest&#39;</span>),</a>
<a class="sourceLine" id="cb10-55" title="55">                        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;Logistic Regression&#39;</span>, </a>
<a class="sourceLine" id="cb10-56" title="56">                                   <span class="st">&#39;Decision Tree&#39;</span>,</a>
<a class="sourceLine" id="cb10-57" title="57">                                   <span class="st">&#39;Boosting&#39;</span>, </a>
<a class="sourceLine" id="cb10-58" title="58">                                   <span class="st">&#39;Random Forest&#39;</span>),</a>
<a class="sourceLine" id="cb10-59" title="59">                        <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&#39;#C0392B&#39;</span>, </a>
<a class="sourceLine" id="cb10-60" title="60">                                   <span class="st">&#39;#3498DB&#39;</span>, </a>
<a class="sourceLine" id="cb10-61" title="61">                                   <span class="st">&#39;#28B463&#39;</span>, </a>
<a class="sourceLine" id="cb10-62" title="62">                                   <span class="st">&#39;#9B59B6&#39;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-63" title="63"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&#39;True Positive Rate&#39;</span>,</a>
<a class="sourceLine" id="cb10-64" title="64">         <span class="dt">x =</span> <span class="st">&#39;False Positive Rate&#39;</span>,</a>
<a class="sourceLine" id="cb10-65" title="65">         <span class="dt">title =</span> <span class="st">&#39;Receiver Oerating Characteristic Curve - ROC&#39;</span>,</a>
<a class="sourceLine" id="cb10-66" title="66">         <span class="dt">subtitle =</span> <span class="st">&#39;Random Forest and Boosting are the models that best discriminate Defaulters and Non-Defaulters&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-67" title="67"><span class="st">    </span><span class="kw">theme_economist</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-68" title="68"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb10-69" title="69">  </a>
<a class="sourceLine" id="cb10-70" title="70">  <span class="kw">return</span> (p)</a>
<a class="sourceLine" id="cb10-71" title="71">}</a></code></pre></div>
</div>
<div id="accuracy" class="section level3">
<h3><span class="header-section-number">2.4.5</span> accuracy</h3>
<p>Function used to output confusion matrix and basic accuracy metrics of each model.</p>
<p>Needs to receive a vector of actual and predicted values.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">accuracy &lt;-<span class="st"> </span><span class="cf">function</span>(score, actual, <span class="dt">threshold =</span> <span class="fl">0.5</span>) {</a>
<a class="sourceLine" id="cb11-2" title="2">  </a>
<a class="sourceLine" id="cb11-3" title="3">  fitted.results &lt;-<span class="st"> </span><span class="kw">ifelse</span>(score <span class="op">&gt;</span><span class="st"> </span>threshold ,<span class="dv">1</span> ,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-4" title="4">  </a>
<a class="sourceLine" id="cb11-5" title="5">  misClasificError &lt;-<span class="st"> </span><span class="kw">mean</span>(fitted.results <span class="op">!=</span><span class="st"> </span>actual)</a>
<a class="sourceLine" id="cb11-6" title="6">  </a>
<a class="sourceLine" id="cb11-7" title="7">  misClassCount &lt;-<span class="st"> </span><span class="kw">misclassCounts</span>(fitted.results, actual)</a>
<a class="sourceLine" id="cb11-8" title="8">  </a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="kw">print</span>(<span class="kw">kable</span>(misClassCount<span class="op">$</span>conf.matrix))</a>
<a class="sourceLine" id="cb11-10" title="10">  </a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="kw">print</span>(<span class="st">&#39;--------------------------------------------------------------&#39;</span>)</a>
<a class="sourceLine" id="cb11-12" title="12">  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;Model General Accuracy of: &#39;</span>, </a>
<a class="sourceLine" id="cb11-13" title="13">              <span class="kw">round</span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>misClassCount<span class="op">$</span>metrics[<span class="st">&#39;ER&#39;</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&#39;%&#39;</span>, </a>
<a class="sourceLine" id="cb11-14" title="14">              <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;True Positive Rate of    : &#39;</span>, </a>
<a class="sourceLine" id="cb11-16" title="16">              <span class="kw">round</span>(misClassCount<span class="op">$</span>metrics[<span class="st">&#39;TPR&#39;</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&#39;%&#39;</span>,</a>
<a class="sourceLine" id="cb11-17" title="17">              <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb11-18" title="18">}</a></code></pre></div>
<hr />
</div>
</div>
</div>
<div id="data-ingestion-step-2" class="section level1">
<h1><span class="header-section-number">3</span> Data Ingestion (step 2)</h1>
<p>The process of data ingestion — preparing data for analysis — usually includes steps called extract (taking the data from its current location), transform (cleansing and normalizing the data), and load (placing the data in a database where it can be analyzed).</p>
<p>During this step, in addition to the loading data processes, it was performed data casting, column renaming and small touch-ups. The list below describe each table adjustment taken:</p>
<ul>
<li><strong>Table 1</strong>: short description about what was done in the table 1;</li>
<li><strong>Table 2</strong>: short description about what was done in the table 2;</li>
<li><strong>Table 3</strong>: short description about what was done in the table 3;</li>
<li><strong>Table n</strong>: short description about what was done in the table n;</li>
</ul>
<hr />
</div>
<div id="data-cleaning-step-3" class="section level1">
<h1><span class="header-section-number">4</span> Data Cleaning (step 3)</h1>
<p>The objective of this step is analysing missing values and other strange conditions. In order to accomplish this task, a few R functions were used to quickly discover missing values, like NA and empty fields.</p>
<p>First thing done, was fixing observations in k_symbol transaction table with ’ ’ (one space) to empty string (’’), using the following command.</p>
<p>Then, the command below was used to find out any NA values in each table.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">sapply</span>(TableName, <span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a></code></pre></div>
<p>Solely the <strong>transaction</strong> table has NA values, in the following columns:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>x_order</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>x_season</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>x_episode</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>x_character_killed</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>x_killer</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>x_method</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>x_method_cat</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>x_reason</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>x_location</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>x_allegiance</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>x_importance</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Finally, the following command was used in each table to find out where empty values was hidden.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">sapply</span>(TableName, <span class="cf">function</span>(x) <span class="kw">table</span>(<span class="kw">as.character</span>(x) <span class="op">==</span><span class="st">&quot;&quot;</span>)[<span class="st">&quot;TRUE&quot;</span>])</a></code></pre></div>
<p>Again, only the <strong>transaction</strong> table had empty values, according to the table below:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>x_order.NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>x_season.NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>x_episode.NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>x_character_killed.NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>x_killer.NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>x_method.NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>x_method_cat.NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>x_reason.NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>x_location.NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>x_allegiance.NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>x_importance.NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>For the exploration analysis report, we did not take any additional action, since the missing values was not relevant.</p>
<hr />
</div>
<div id="label-translation-step-4" class="section level1">
<h1><span class="header-section-number">5</span> Label Translation (step 4)</h1>
<p>In order to make the data information more understandable, it was translated some relevant labels and domains from Czech to English.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Translating relevant labels and domains to english --------------------------------------------</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3">mytable<span class="op">$</span>x_var_<span class="dv">1</span> &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(mytable<span class="op">$</span>x_var_<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb14-4" title="4">                                   <span class="kw">c</span>(<span class="st">&#39;Other_Language_Column_Name1&#39;</span>, </a>
<a class="sourceLine" id="cb14-5" title="5">                                     <span class="st">&#39;Other_Language_Column_Name2&#39;</span>, </a>
<a class="sourceLine" id="cb14-6" title="6">                                     <span class="st">&#39;Other_Language_Column_Name3&#39;</span>),</a>
<a class="sourceLine" id="cb14-7" title="7">                                   <span class="kw">c</span>(<span class="st">&#39;English_Column_Name1&#39;</span>, </a>
<a class="sourceLine" id="cb14-8" title="8">                                     <span class="st">&#39;English_Column_Name2&#39;</span>, </a>
<a class="sourceLine" id="cb14-9" title="9">                                     <span class="st">&#39;English_Column_Name3&#39;</span>))</a></code></pre></div>
<hr />
</div>
<div id="data-enhancement-step-5" class="section level1">
<h1><span class="header-section-number">6</span> Data Enhancement (step 5)</h1>
<p>This step aims to improve the analysis by adding auxiliary information. Data enhancement is all about making sure any data that is coming into the business is being looked at with a critical eye and is being filtered down to maximize its value.</p>
<p>&lt;Describe what kind of data enhancement you have to do. Include chuncks of code to ilustrate what is necessary.&gt;</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># your code with the enhancements goes here</span></a></code></pre></div>
<hr />
</div>
<div id="data-preparation-for-predictive-modeling-step-6" class="section level1">
<h1><span class="header-section-number">7</span> Data Preparation for Predictive Modeling (step 6)</h1>
<div id="selecting-the-target-dataset" class="section level2">
<h2><span class="header-section-number">7.1</span> Selecting the target dataset</h2>
<p>The below function was created to be used in the modeling exercises to be performed, the idea is to have a standard way to get the prepared data set already prepared with correct data types and dummies.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># your code with the data preparation goes here</span></a></code></pre></div>
</div>
<div id="splitting-dataset-into-train-and-test-data" class="section level2">
<h2><span class="header-section-number">7.2</span> Splitting dataset into Train and Test data</h2>
<p>The below function was created to be used in the modeling exercises to be split the source_dataset into train and test datasets.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">mydataset &lt;-<span class="st"> </span>fgvr<span class="op">::</span><span class="kw">createTestAndTrainSamples</span>(<span class="dt">dataset =</span> you_dataset_name, <span class="dt">yvar =</span> <span class="st">&quot;your_y_var&quot;</span>, </a>
<a class="sourceLine" id="cb17-2" title="2">                                             <span class="dt">seed =</span> <span class="dv">12345</span>, <span class="dt">percentage =</span> <span class="fl">0.7</span>)</a></code></pre></div>
<p>To make sure all the models uses the same datasets for Train and Testing we are saving the initial sampling to be reused across the models.</p>
<p>This will ensure consistency when comparing the models against each other.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># calling function to split and create train and test databases</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co"># this function will split the dataset into train and test data and save the sampling in disk</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co"># to resample just delete &#39;./models/source_train_test_dataset.rds&#39; file and rerun this script</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&#39;./models/source_train_test_dataset.rds&#39;</span>)) {</a>
<a class="sourceLine" id="cb18-5" title="5">  source_train_test_dataset &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&#39;./models/source_train_test_dataset.rds&#39;</span>)</a>
<a class="sourceLine" id="cb18-6" title="6">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb18-7" title="7">  source_train_test_dataset &lt;-<span class="st"> </span>mydataset</a>
<a class="sourceLine" id="cb18-8" title="8">  <span class="kw">saveRDS</span>(source_train_test_dataset, <span class="st">&#39;./models/source_train_test_dataset.rds&#39;</span>)  </a>
<a class="sourceLine" id="cb18-9" title="9">}</a></code></pre></div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
